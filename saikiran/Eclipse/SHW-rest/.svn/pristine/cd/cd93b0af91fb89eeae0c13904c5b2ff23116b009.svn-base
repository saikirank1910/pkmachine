package com.prokarma.sourcerer.service.impl;

import java.util.List;

import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.stereotype.Service;

import com.prokarma.sourcerer.dao.UserDao;
import com.prokarma.sourcerer.dto.Email;
import com.prokarma.sourcerer.dto.User;
import com.prokarma.sourcerer.service.UserService;
import com.prokarma.sourcerer.utils.GenerateMessage;
import com.prokarma.sourcerer.utils.SMTP;

@Service
public class UserServiceImpl implements UserService {
	
	final static org.apache.log4j.Logger FileLogger = Logger.getLogger("logger.file");
	
	@Autowired
	UserDao userdaoimpl;

	@Autowired
	private SMTP smtp;

	@Autowired
	private GenerateMessage generateMessage;

	public User getUserService(User userLoginDetails) {
		User userDetails = userdaoimpl.getUser(userLoginDetails);
		try {
			if (userDetails.getPassword().equals(userLoginDetails.getPassword())) {
				return userDetails;
			}
		} catch (java.lang.NullPointerException exception) {
			FileLogger.error("error while retreiving data"+exception.getMessage());
		}
		return null;
	}

	public boolean forgotPassoword(User userDetails) {
		boolean success = false;
		try {
			User userFromDb = userdaoimpl.forgotPassword(userDetails);
			if (userFromDb.getPassword() != null) {
				Email toUser = generateMessage.sendForgotPasswordToUser(userFromDb);
				smtp.sendMail(toUser);
				return true;
			}
		} catch (DataAccessException dataAccessException) {
			FileLogger.error("error in forgot password service"+dataAccessException.getMessage());
			return success;
		}
		return success;
	}

	public boolean insertUserService(User user) {
		try {
		return userdaoimpl.insertUser(user);
		}catch(DataAccessException dataAccessException) {
			FileLogger.error("error while saving a user"+dataAccessException.getMessage());
			return false;
		}

	}

	public boolean editUserService(User userDetails) {
		try {
			return userdaoimpl.editUser(userDetails);
		} catch (final DataAccessException dataAccessException) {
			FileLogger.error("error in edit User service"+dataAccessException.getMessage());
			return false;
		}
	}

	public boolean deleteUserService(User userDetails) {
		try {
			return userdaoimpl.deleteUser(userDetails);
		} catch (final DataAccessException dataAccessException) {
			FileLogger.error("error in delete user service"+dataAccessException.getMessage());
			return false;
		}
	}

	public List<User> getAllUsersService() {
		return userdaoimpl.getAllUsers();
	}

}

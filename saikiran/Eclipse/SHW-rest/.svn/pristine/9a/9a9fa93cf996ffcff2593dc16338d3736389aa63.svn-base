package com.prokarma.sourcerer.dao.impl;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.stereotype.Component;

import com.prokarma.sourcerer.dao.CandidateSelfRatingDao;
import com.prokarma.sourcerer.dto.CandidateSelfRating;
import com.prokarma.sourcerer.dto.PanelAssignee;
import com.prokarma.sourcerer.dto.Subtechnology;

@Component
public class CandidateSelfRatingDaoImpl implements CandidateSelfRatingDao {

	@Autowired
	private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

	
	

	public Boolean insertSelfRating(List<CandidateSelfRating> list) {

		String query = "insert into candidate_self_rating values (csrid.nextval,:ratingId,:technologyId,:cid)";
		for (CandidateSelfRating candidateSelfRating : list) {
			MapSqlParameterSource params = new MapSqlParameterSource();
			params.addValue("ratingId", candidateSelfRating.getRatingId());
			params.addValue("technologyId", candidateSelfRating.getTechnolgyId());
			params.addValue("cid", candidateSelfRating.getCid());
			int i = namedParameterJdbcTemplate.update(query, params);
			if(i!=1)
				return false;
		}
		return true;
	}

	public List<CandidateSelfRating> getSelfRating(int cid) {
		String sql = "select c.RATINGID,t.TECHNICLESUBSKILL from candidate_self_rating c,techinicle_sub_skills t where c.technicleid=t.tsskillid and c.cid = :cid";
		final MapSqlParameterSource params = new MapSqlParameterSource();
		params.addValue("cid", cid);
		return namedParameterJdbcTemplate.query(sql, params, new RowMapper<CandidateSelfRating>() {

			public CandidateSelfRating mapRow(ResultSet resultSet, int index) throws SQLException {
				final CandidateSelfRating candidateSelfRating = new CandidateSelfRating();

				candidateSelfRating.setRatingId(resultSet.getInt(1));
				candidateSelfRating.setTechnologyName(resultSet.getString(2));
				return candidateSelfRating;
			}

		});

	}

	
}
